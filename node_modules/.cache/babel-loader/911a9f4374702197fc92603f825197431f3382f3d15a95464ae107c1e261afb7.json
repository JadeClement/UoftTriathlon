{"ast":null,"code":"import _objectSpread from\"/Users/jadeclement/Documents/Developer/uofttri/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useState,useEffect}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth must be used within an AuthProvider');}return context;};export const AuthProvider=_ref=>{let{children}=_ref;const[currentUser,setCurrentUser]=useState(null);const[loading,setLoading]=useState(true);const API_BASE_URL='http://localhost:5001/api';useEffect(()=>{console.log('🔄 AuthContext useEffect running...');// Check if user is logged in from localStorage (for now)\nconst savedUser=localStorage.getItem('triathlonUser');console.log('📦 Saved user from localStorage:',savedUser);if(savedUser){try{const parsedUser=JSON.parse(savedUser);console.log('✅ Parsed user successfully:',parsedUser);setCurrentUser(parsedUser);}catch(error){console.error('❌ Error parsing saved user:',error);localStorage.removeItem('triathlonUser');}}else{console.log('❌ No saved user found in localStorage');}setLoading(false);console.log('🏁 AuthContext loading complete');},[]);const signup=async(email,password,name,phoneNumber)=>{try{const response=await fetch(\"\".concat(API_BASE_URL,\"/auth/signup\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password,name,phoneNumber})});if(!response.ok){const errorData=await response.json();throw new Error(errorData.error||'Signup failed');}const user=await response.json();// Store user in localStorage for now (will be replaced with JWT)\nlocalStorage.setItem('triathlonUser',JSON.stringify(user));setCurrentUser(user);return user;}catch(error){console.error('Signup error:',error);throw error;}};const login=async(email,password)=>{try{console.log('🔐 Attempting login for:',email);const response=await fetch(\"\".concat(API_BASE_URL,\"/auth/login\"),{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});if(!response.ok){const errorData=await response.json();throw new Error(errorData.error||'Login failed');}const{user,token}=await response.json();console.log('✅ Login response received:',user);// Store user and token\nlocalStorage.setItem('triathlonUser',JSON.stringify(user));localStorage.setItem('triathlonToken',token);console.log('💾 User stored in localStorage');setCurrentUser(user);console.log('👤 Current user state set to:',user);return user;}catch(error){console.error('❌ Login error:',error);throw error;}};const logout=()=>{localStorage.removeItem('triathlonUser');localStorage.removeItem('triathlonToken');setCurrentUser(null);};const getUserRole=user=>{if(!user)return'public';return user.role||'public';};const hasPermission=(user,requiredRole)=>{const userRole=getUserRole(user);const roleHierarchy={'public':0,'pending':1,'member':2,'exec':3,'administrator':4};return roleHierarchy[userRole]>=roleHierarchy[requiredRole];};const isAdmin=user=>{return hasPermission(user,'administrator');};const isExec=user=>{return hasPermission(user,'exec');};const isMember=user=>{return hasPermission(user,'member');};// Temporary function to promote current user to admin (for development)\nconst promoteToAdmin=()=>{if(currentUser){const updatedUser=_objectSpread(_objectSpread({},currentUser),{},{role:'administrator'});setCurrentUser(updatedUser);localStorage.setItem('triathlonUser',JSON.stringify(updatedUser));return updatedUser;}return null;};// Function to update user profile\nconst updateUser=updatedUserData=>{const updatedUser=_objectSpread(_objectSpread({},currentUser),updatedUserData);setCurrentUser(updatedUser);localStorage.setItem('triathlonUser',JSON.stringify(updatedUser));return updatedUser;};const value={currentUser,signup,login,logout,loading,isAdmin,isExec,isMember,hasPermission,getUserRole,promoteToAdmin,updateUser};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:!loading&&children});};","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","jsx","_jsx","AuthContext","useAuth","context","Error","AuthProvider","_ref","children","currentUser","setCurrentUser","loading","setLoading","API_BASE_URL","console","log","savedUser","localStorage","getItem","parsedUser","JSON","parse","error","removeItem","signup","email","password","name","phoneNumber","response","fetch","concat","method","headers","body","stringify","ok","errorData","json","user","setItem","login","token","logout","getUserRole","role","hasPermission","requiredRole","userRole","roleHierarchy","isAdmin","isExec","isMember","promoteToAdmin","updatedUser","_objectSpread","updateUser","updatedUserData","value","Provider"],"sources":["/Users/jadeclement/Documents/Developer/uofttri/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth must be used within an AuthProvider');\n  }\n  return context;\n};\n\nexport const AuthProvider = ({ children }) => {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  const API_BASE_URL = 'http://localhost:5001/api';\n\n  useEffect(() => {\n    console.log('🔄 AuthContext useEffect running...');\n    \n    // Check if user is logged in from localStorage (for now)\n    const savedUser = localStorage.getItem('triathlonUser');\n    console.log('📦 Saved user from localStorage:', savedUser);\n    \n    if (savedUser) {\n      try {\n        const parsedUser = JSON.parse(savedUser);\n        console.log('✅ Parsed user successfully:', parsedUser);\n        setCurrentUser(parsedUser);\n      } catch (error) {\n        console.error('❌ Error parsing saved user:', error);\n        localStorage.removeItem('triathlonUser');\n      }\n    } else {\n      console.log('❌ No saved user found in localStorage');\n    }\n    \n    setLoading(false);\n    console.log('🏁 AuthContext loading complete');\n  }, []);\n\n  const signup = async (email, password, name, phoneNumber) => {\n    try {\n      const response = await fetch(`${API_BASE_URL}/auth/signup`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ email, password, name, phoneNumber }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Signup failed');\n      }\n\n      const user = await response.json();\n      \n      // Store user in localStorage for now (will be replaced with JWT)\n      localStorage.setItem('triathlonUser', JSON.stringify(user));\n      setCurrentUser(user);\n      return user;\n    } catch (error) {\n      console.error('Signup error:', error);\n      throw error;\n    }\n  };\n\n  const login = async (email, password) => {\n    try {\n      console.log('🔐 Attempting login for:', email);\n      \n      const response = await fetch(`${API_BASE_URL}/auth/login`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ email, password }),\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error || 'Login failed');\n      }\n\n      const { user, token } = await response.json();\n      console.log('✅ Login response received:', user);\n      \n      // Store user and token\n      localStorage.setItem('triathlonUser', JSON.stringify(user));\n      localStorage.setItem('triathlonToken', token);\n      console.log('💾 User stored in localStorage');\n      \n      setCurrentUser(user);\n      console.log('👤 Current user state set to:', user);\n      \n      return user;\n    } catch (error) {\n      console.error('❌ Login error:', error);\n      throw error;\n    }\n  };\n\n  const logout = () => {\n    localStorage.removeItem('triathlonUser');\n    localStorage.removeItem('triathlonToken');\n    setCurrentUser(null);\n  };\n\n  const getUserRole = (user) => {\n    if (!user) return 'public';\n    return user.role || 'public';\n  };\n\n  const hasPermission = (user, requiredRole) => {\n    const userRole = getUserRole(user);\n    const roleHierarchy = {\n      'public': 0,\n      'pending': 1,\n      'member': 2,\n      'exec': 3,\n      'administrator': 4\n    };\n    \n    return roleHierarchy[userRole] >= roleHierarchy[requiredRole];\n  };\n\n  const isAdmin = (user) => {\n    return hasPermission(user, 'administrator');\n  };\n\n  const isExec = (user) => {\n    return hasPermission(user, 'exec');\n  };\n\n  const isMember = (user) => {\n    return hasPermission(user, 'member');\n  };\n\n  // Temporary function to promote current user to admin (for development)\n  const promoteToAdmin = () => {\n    if (currentUser) {\n      const updatedUser = { ...currentUser, role: 'administrator' };\n      setCurrentUser(updatedUser);\n      localStorage.setItem('triathlonUser', JSON.stringify(updatedUser));\n      return updatedUser;\n    }\n    return null;\n  };\n\n  // Function to update user profile\n  const updateUser = (updatedUserData) => {\n    const updatedUser = { ...currentUser, ...updatedUserData };\n    setCurrentUser(updatedUser);\n    localStorage.setItem('triathlonUser', JSON.stringify(updatedUser));\n    return updatedUser;\n  };\n\n  const value = {\n    currentUser,\n    signup,\n    login,\n    logout,\n    loading,\n    isAdmin,\n    isExec,\n    isMember,\n    hasPermission,\n    getUserRole,\n    promoteToAdmin,\n    updateUser\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {!loading && children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}